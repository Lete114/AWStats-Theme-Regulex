function trim(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function getParams(){var e=location.hash;return!e||e.length<2?e={embed:!1,re:"",highlight:!0,flags:""}:((e=(e=e.slice(2)).split("&").reduce(function(e,t){return e[(t=t.split("="))[0]]=t[1],e},{})).embed="true"===e.embed,e.flags=e.flags||"",e.re=e.re?trim(decodeURIComponent(e.re)):""),e}console.log("\n %c AWStats-Regulex %c https://github.com/lete114/AWStats-Theme-Regulex \n","color: #80bdab; background: #333; padding:5px 0;","background: #80bdab; padding:5px 0;");var embedFooterLink,params=getParams();function $(e){return document.getElementById(e)}function $$(e){return document.querySelector(e)}function init(e,r,o,a){function i(){return trim(s.value)}function c(e){return s.value=trim(e)}var d,l=e("graphCt",10,10),s=$("input"),u=($("inputCt"),$("visualIt")),m=$("embedIt"),g=$("exportIt"),p=$("errorBox"),v=document.getElementsByName("flag"),f=$("flagBox");function h(t){var e,n=i();b(),p.style.display="none";try{e=o(n)}catch(e){if(!(e instanceof o.RegexSyntaxError))throw e;return t||function(e,t){p.style.display="block";var n=["Error:"+t.message,""];"number"==typeof t.lastIndex&&(n.push(e),n.push(a.repeats("-",t.lastIndex)+"^"));L(p,n.join("\n"))}(n,e),!1}return r(e,w(),l),!0}function b(){var e,t,n;location.hash=(e=params,t=i(),n=w(),"#!"+(e.debug?"debug=true&":"")+(e.cmd?"cmd="+e.cmd+"&":"")+(e.embed?"embed=true&":"")+"flags="+n+"&re="+encodeURIComponent(e.re=t))}function w(){for(var e="",t=0,n=v.length;t<n;t++)v[t].checked&&(e+=v[t].value);return e}function x(e){for(var t=0,n=e.length;t<n;t++)~e.indexOf(v[t].value)?v[t].checked=!0:v[t].checked=!1;L(f,e)}function y(){var e=window.devicePixelRatio||1;svg=graphCt.getElementsByTagName("svg")[0];var t=svg.clientWidth||parseInt(getComputedStyle(svg).width),n=svg.clientHeight||parseInt(getComputedStyle(svg).height),o=new Image;o.width=t,o.height=n,o.setAttribute("src",E(svg));var a=document.createElement("canvas");a.width=t*e,a.height=n*e,a.style.width=t+"px",a.style.height=n+"px",a.className="exportCanvas";var i=a.getContext("2d");i.setTransform(e,0,0,e,0,0),o.onload=function(){var e,t,n,r;i.drawImage(o,0,0),e=a,(r=prompt("请输入您需要下载的文件名和格式","Regulex.png"))&&(t="",t="svg"===r?E($$("#graphCt svg")):e.toDataURL("image/"+r),n=document.createElement("a"),e=new MouseEvent("click"),n.download=r,n.href=t,n.dispatchEvent(e))}}function E(e){e=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml,"+encodeURIComponent(e)}function L(e,t){e.innerHTML="";var n=document.createTextNode("");return n.nodeValue=t,e.appendChild(n),t}params.flags&&x(params.flags),params.re&&c(params.re),h(),"export"==params.cmd?y():(function(){var t="\n".charCodeAt(0),n="\r".charCodeAt(0);s.addEventListener("keydown",function(e){e.keyCode!==t&&e.keyCode!==n||(e.preventDefault(),e.stopPropagation(),h())}),s.addEventListener("keyup",function(e){if(e.keyCode===t||e.keyCode===n)return!0;clearTimeout(r),r=setTimeout(function(){h(!0)},100)}),s.addEventListener("paste",function(e){var t=trim(e.clipboardData.getData("text"));"/"===t[0]&&/\/[img]*$/.test(t)&&(e.preventDefault(),e=t.lastIndexOf("/"),x(t.slice(e+1)),t=t.slice(1,e),c(t)),setTimeout(h,50)}),u.addEventListener("click",function(){h()}),m.addEventListener("click",function(){if(!h())return!1;var e=(t=location.href).indexOf("#"),t=0<e?t.slice(0,e):t;b();e=i(),e='<iframe frameborder="0" width="'+Math.ceil(l.width)+'" height="'+Math.ceil(l.height)+'" src="'+t+"#!embed=true&flags="+w()+"&re="+encodeURIComponent(e)+'"></iframe>';window.prompt("Copy the html code:",e)}),g.addEventListener("click",function(){y()});for(var r,e=0,o=v.length;e<o;e++)v[e].addEventListener("change",a);function a(e){L(f,w()),h(),b()}}(),(d=$("graphCt")).addEventListener("mousedown",function(e){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty();var r=e.clientX,o=e.clientY;function t(e){d.removeEventListener("mousemove",n),document.removeEventListener("mouseup",t,!0),window.removeEventListener("mouseup",t,!0)}function n(e){var t=r-e.clientX,n=o-e.clientY;0<t&&d.scrollWidth-d.scrollLeft-d.clientWidth<2||t<0&&d.scrollLeft<1?(document.documentElement.scrollLeft+=t,document.body.scrollLeft+=t):d.scrollLeft+=t,0<n&&d.scrollHeight-d.scrollTop-d.clientHeight<2||n<0&&d.scrollTop<1?(document.documentElement.scrollTop+=n,document.body.scrollTop+=n):d.scrollTop+=n,r=e.clientX,o=e.clientY}d.addEventListener("mousemove",n),document.addEventListener("mouseup",t,!0),window.addEventListener("mouseup",t,!0)}))}!params.embed&&"export"!=params.cmd||(document.body.className+=" embed"),!params.embed&&"export"!==params.cmd||((embedFooterLink=document.getElementById("embedFooterLink")).href=location.href.replace(/\bembed=true\b/gi,"").replace(/\bcmd=export\b/gi,"")),window.addEventListener("DOMContentLoaded",function(){raphael=require("regulex").Raphael,parse=require("regulex").parse,visualize=require("regulex").visualize,Kit=require("regulex").Kit,init(raphael,visualize,parse,Kit)});